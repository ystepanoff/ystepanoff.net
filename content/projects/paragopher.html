+++
title = "ParaGopher"
description = "ParaGopher is a retro-style arcade game written in Go. Inspired by the classic Paratrooper IBM PC game (1982), the game allows the player to control a turret that must defend the base against incoming paratroopers."
image = "/projects/images/ParaGopher.png"
weight = 3
+++

<div class="block">
  <h3>ParaGopher</h3>

  {{< img "/projects/images/ParaGopher.png" >}} I played
  <a href="https://www.retrogames.cz/play_616-DOS.php" target="_blank">Paratrooper</a> a ton back when I was a kid, and
  stumbling across <a href="https://ebitengine.org" target="_blank">Ebitengine</a>—a super straightforward 2D game
  engine—brought all those memories rushing back. So I went ahead and made my own nostalgia-fueled version, and it only
  took a couple of hours to get a basic prototype going! Now I’ve jotted down a few notes on the simple maths behind
  ParaGopher for anyone curious.

  <h4>Rotating and drawing the turret barrel</h4>
  When drawing the turret barrel, the code rotates it around its center before positioning it on the screen:

  <pre><code>op.GeoM.Translate(-barrelW/2.0, -barrelH/2.0) // Move the barrel origin to its center
op.GeoM.Rotate(g.barrelAngle * math.Pi / 180)
op.GeoM.Translate(centerX, centerY)</code></pre>

  <h4>Finding the bullet's spawn position (tip of the barrel)</h4>
  When you press shoot, the game creates a bullet at the tip of the barrel. The code first identifies a local offset in
  the barrel’s coordinate system—something like:
  <pre><code>localTipX := width / 2 // half of the base width
localTipY := width / 12</code></pre>
  Then it rotates these local coordinates by the turret’s angle to get the world position of the tip:
  <pre><code>dx := float64(localTipX - width/2)
dy := float64(localTipY - width/2)

rx := float32(dx*math.Cos(angleRadians) - dy*math.Sin(angleRadians))
ry := float32(dx*math.Sin(angleRadians) + dy*math.Cos(angleRadians))

tipX := barrelCircleX + rx
tipY := barrelCircleY + ry</code></pre>
  Here <code>(dx, dy)</code> is the local offset from the pivot. The standard 2D rotation formulae are

  <span class="katex-display"
    ><span class="katex"
      ><span class="katex-mathml"
        ><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"
          ><semantics
            ><mtable rowspacing="0.16em" columnspacing="1em"
              ><mtr
                ><mtd class="mtr-glue"></mtd
                ><mtd
                  ><mstyle scriptlevel="0" displaystyle="true"
                    ><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"
                      ><mtr
                        ><mtd
                          ><mstyle scriptlevel="0" displaystyle="false"
                            ><mrow
                              ><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup
                              ><mo>=</mo><mi>x</mi><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi
                              ><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi><mi>sin</mi><mo>⁡</mo
                              ><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo
                              ><mo separator="true">,</mo></mrow
                            ></mstyle
                          ></mtd
                        ></mtr
                      ><mtr
                        ><mtd
                          ><mstyle scriptlevel="0" displaystyle="false"
                            ><mrow
                              ><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup
                              ><mo>=</mo><mi>x</mi><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi
                              ><mo stretchy="false">)</mo><mo>+</mo><mi>y</mi><mi>cos</mi><mo>⁡</mo
                              ><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo
                              ><mi mathvariant="normal">,</mi></mrow
                            ></mstyle
                          ></mtd
                        ></mtr
                      ></mtable
                    ></mstyle
                  ></mtd
                ><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable
            ><annotation encoding="application/x-tex"
              >\begin{equation} \begin{array}{l} x&#x27; = x\cos(\theta)-y\sin(\theta), \\ y&#x27; =
              x\sin(\theta)+y\cos(\theta). \end{array} \end{equation}
            </annotation></semantics
          ></math
        ></span
      ><span class="katex-html" aria-hidden="true"
        ><span class="base"
          ><span class="strut" style="height: 2.4em; vertical-align: -0.95em"></span
          ><span class="mtable"
            ><span class="col-align-c"
              ><span class="vlist-t vlist-t2"
                ><span class="vlist-r"
                  ><span class="vlist" style="height: 1.45em"
                    ><span style="top: -3.45em"
                      ><span class="pstrut" style="height: 3.45em"></span
                      ><span class="mord"
                        ><span class="mord"
                          ><span class="mtable"
                            ><span class="arraycolsep" style="width: 0.5em"></span
                            ><span class="col-align-l"
                              ><span class="vlist-t vlist-t2"
                                ><span class="vlist-r"
                                  ><span class="vlist" style="height: 1.45em"
                                    ><span style="top: -3.61em"
                                      ><span class="pstrut" style="height: 3em"></span
                                      ><span class="mord"
                                        ><span class="mord"
                                          ><span class="mord mathnormal">x</span
                                          ><span class="msupsub"
                                            ><span class="vlist-t"
                                              ><span class="vlist-r"
                                                ><span class="vlist" style="height: 0.7519em"
                                                  ><span style="top: -3.063em; margin-right: 0.05em"
                                                    ><span class="pstrut" style="height: 2.7em"></span
                                                    ><span class="sizing reset-size6 size3 mtight"
                                                      ><span class="mord mtight"
                                                        ><span class="mord mtight">′</span></span
                                                      ></span
                                                    ></span
                                                  ></span
                                                ></span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="mspace" style="margin-right: 0.2778em"></span
                                        ><span class="mrel">=</span
                                        ><span class="mspace" style="margin-right: 0.2778em"></span
                                        ><span class="mord mathnormal">x</span
                                        ><span class="mspace" style="margin-right: 0.1667em"></span
                                        ><span class="mop">cos</span><span class="mopen">(</span
                                        ><span class="mord mathnormal" style="margin-right: 0.02778em">θ</span
                                        ><span class="mclose">)</span
                                        ><span class="mspace" style="margin-right: 0.2222em"></span
                                        ><span class="mbin">−</span
                                        ><span class="mspace" style="margin-right: 0.2222em"></span
                                        ><span class="mord mathnormal" style="margin-right: 0.03588em">y</span
                                        ><span class="mspace" style="margin-right: 0.1667em"></span
                                        ><span class="mop">sin</span><span class="mopen">(</span
                                        ><span class="mord mathnormal" style="margin-right: 0.02778em">θ</span
                                        ><span class="mclose">)</span><span class="mpunct">,</span></span
                                      ></span
                                    ><span style="top: -2.41em"
                                      ><span class="pstrut" style="height: 3em"></span
                                      ><span class="mord"
                                        ><span class="mord"
                                          ><span class="mord mathnormal" style="margin-right: 0.03588em">y</span
                                          ><span class="msupsub"
                                            ><span class="vlist-t"
                                              ><span class="vlist-r"
                                                ><span class="vlist" style="height: 0.7519em"
                                                  ><span style="top: -3.063em; margin-right: 0.05em"
                                                    ><span class="pstrut" style="height: 2.7em"></span
                                                    ><span class="sizing reset-size6 size3 mtight"
                                                      ><span class="mord mtight"
                                                        ><span class="mord mtight">′</span></span
                                                      ></span
                                                    ></span
                                                  ></span
                                                ></span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="mspace" style="margin-right: 0.2778em"></span
                                        ><span class="mrel">=</span
                                        ><span class="mspace" style="margin-right: 0.2778em"></span
                                        ><span class="mord mathnormal">x</span
                                        ><span class="mspace" style="margin-right: 0.1667em"></span
                                        ><span class="mop">sin</span><span class="mopen">(</span
                                        ><span class="mord mathnormal" style="margin-right: 0.02778em">θ</span
                                        ><span class="mclose">)</span
                                        ><span class="mspace" style="margin-right: 0.2222em"></span
                                        ><span class="mbin">+</span
                                        ><span class="mspace" style="margin-right: 0.2222em"></span
                                        ><span class="mord mathnormal" style="margin-right: 0.03588em">y</span
                                        ><span class="mspace" style="margin-right: 0.1667em"></span
                                        ><span class="mop">cos</span><span class="mopen">(</span
                                        ><span class="mord mathnormal" style="margin-right: 0.02778em">θ</span
                                        ><span class="mclose">)</span><span class="mord">.</span></span
                                      ></span
                                    ></span
                                  ><span class="vlist-s">​</span></span
                                ><span class="vlist-r"
                                  ><span class="vlist" style="height: 0.95em"><span></span></span></span></span></span
                            ><span class="arraycolsep" style="width: 0.5em"></span></span></span></span></span></span
                  ><span class="vlist-s">​</span></span
                ><span class="vlist-r"
                  ><span class="vlist" style="height: 0.95em"><span></span></span></span></span></span></span></span
        ><span class="tag"
          ><span class="vlist-t vlist-t2"
            ><span class="vlist-r"
              ><span class="vlist" style="height: 1.45em"
                ><span style="top: -3.45em"
                  ><span class="pstrut" style="height: 3.45em"></span><span class="eqn-num"></span></span></span
              ><span class="vlist-s">​</span></span
            ><span class="vlist-r"
              ><span class="vlist" style="height: 0.95em"><span></span></span></span></span></span></span></span
  ></span>

  Here
  <span class="katex"
    ><span class="katex-mathml"
      ><math xmlns="http://www.w3.org/1998/Math/MathML"
        ><semantics
          ><mrow><mi>θ</mi></mrow
          ><annotation encoding="application/x-tex">\theta </annotation></semantics
        ></math
      ></span
    ><span class="katex-html" aria-hidden="true"
      ><span class="base"
        ><span class="strut" style="height: 0.6944em"></span
        ><span class="mord mathnormal" style="margin-right: 0.02778em">θ</span></span
      ></span
    ></span
  >
  is the rotation angle in radians.

  <h4>Computing bullet's velocity components</h4>

  Once the bullet's initial position <code>(tipX, tipY)</code> is known, its velocity <code>(vx, vy)</code>
  depends on the turret's angle and a speed constant:

  <pre><code>realAngleRadians := (90.0 - g.barrelAngle) * math.Pi / 180.0
vx := float32(config.BulletSpeed * math.Cos(realAngleRadians))
vy := -float32(config.BulletSpeed * math.Sin(realAngleRadians))</code></pre>

  Notice the <code>(90.0 - barrelAngle)</code> logic. This is because in normal world maths angle 0 means pointing along
  the positive
  <span class="katex"
    ><span class="katex-mathml"
      ><math xmlns="http://www.w3.org/1998/Math/MathML"
        ><semantics
          ><mrow><mi>x</mi></mrow
          ><annotation encoding="application/x-tex">x </annotation></semantics
        ></math
      ></span
    ><span class="katex-html" aria-hidden="true"
      ><span class="base"
        ><span class="strut" style="height: 0.4306em"></span><span class="mord mathnormal">x</span></span
      ></span
    ></span
  >-axis, but here it is actually 'straight up', so we're shifting the frame of reference so that 0 means <b>up</b> in
  the game world. Finally, the screen's
  <span class="katex"
    ><span class="katex-mathml"
      ><math xmlns="http://www.w3.org/1998/Math/MathML"
        ><semantics
          ><mrow><mi>y</mi></mrow
          ><annotation encoding="application/x-tex">y </annotation></semantics
        ></math
      ></span
    ><span class="katex-html" aria-hidden="true"
      ><span class="base"
        ><span class="strut" style="height: 0.625em; vertical-align: -0.1944em"></span
        ><span class="mord mathnormal" style="margin-right: 0.03588em">y</span></span
      ></span
    ></span
  >-axis is growing downwards, hence the negative sign in front of the expression for <code>vy</code>.

  <h4>Updating bullet's position (basic kinematics)</h4>
  On every frame, each bullet’s position is updated by adding the velocity:
  <pre><code>b.x += b.vx
b.y += b.vy</code></pre>
  This is effectively
  <span class="katex-display"
    ><span class="katex"
      ><span class="katex-mathml"
        ><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"
          ><semantics
            ><mtable rowspacing="0.16em" columnspacing="1em"
              ><mtr
                ><mtd class="mtr-glue"></mtd
                ><mtd
                  ><mstyle scriptlevel="0" displaystyle="true"
                    ><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"
                      ><mtr
                        ><mtd
                          ><mstyle scriptlevel="0" displaystyle="false"
                            ><mrow
                              ><mi>x</mi><mo>←</mo><mi>x</mi><mo>+</mo><msub><mi>v</mi><mi>x</mi></msub
                              ><mo separator="true">,</mo></mrow
                            ></mstyle
                          ></mtd
                        ></mtr
                      ><mtr
                        ><mtd
                          ><mstyle scriptlevel="0" displaystyle="false"
                            ><mrow
                              ><mi>y</mi><mo>←</mo><mi>y</mi><mo>+</mo><msub><mi>v</mi><mi>y</mi></msub></mrow
                            ></mstyle
                          ></mtd
                        ></mtr
                      ></mtable
                    ></mstyle
                  ></mtd
                ><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable
            ><annotation encoding="application/x-tex"
              >\begin{equation} \begin{array}{l} x\leftarrow x + v_x, \\ y\leftarrow y + v_y \end{array} \end{equation}
            </annotation></semantics
          ></math
        ></span
      ><span class="katex-html" aria-hidden="true"
        ><span class="base"
          ><span class="strut" style="height: 2.4em; vertical-align: -0.95em"></span
          ><span class="mtable"
            ><span class="col-align-c"
              ><span class="vlist-t vlist-t2"
                ><span class="vlist-r"
                  ><span class="vlist" style="height: 1.45em"
                    ><span style="top: -3.45em"
                      ><span class="pstrut" style="height: 3.45em"></span
                      ><span class="mord"
                        ><span class="mord"
                          ><span class="mtable"
                            ><span class="arraycolsep" style="width: 0.5em"></span
                            ><span class="col-align-l"
                              ><span class="vlist-t vlist-t2"
                                ><span class="vlist-r"
                                  ><span class="vlist" style="height: 1.45em"
                                    ><span style="top: -3.61em"
                                      ><span class="pstrut" style="height: 3em"></span
                                      ><span class="mord"
                                        ><span class="mord mathnormal">x</span
                                        ><span class="mspace" style="margin-right: 0.2778em"></span
                                        ><span class="mrel">←</span
                                        ><span class="mspace" style="margin-right: 0.2778em"></span
                                        ><span class="mord mathnormal">x</span
                                        ><span class="mspace" style="margin-right: 0.2222em"></span
                                        ><span class="mbin">+</span
                                        ><span class="mspace" style="margin-right: 0.2222em"></span
                                        ><span class="mord"
                                          ><span class="mord mathnormal" style="margin-right: 0.03588em">v</span
                                          ><span class="msupsub"
                                            ><span class="vlist-t vlist-t2"
                                              ><span class="vlist-r"
                                                ><span class="vlist" style="height: 0.1514em"
                                                  ><span
                                                    style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em"
                                                    ><span class="pstrut" style="height: 2.7em"></span
                                                    ><span class="sizing reset-size6 size3 mtight"
                                                      ><span class="mord mathnormal mtight">x</span></span
                                                    ></span
                                                  ></span
                                                ><span class="vlist-s">​</span></span
                                              ><span class="vlist-r"
                                                ><span class="vlist" style="height: 0.15em"
                                                  ><span></span></span></span></span></span></span
                                        ><span class="mpunct">,</span></span
                                      ></span
                                    ><span style="top: -2.41em"
                                      ><span class="pstrut" style="height: 3em"></span
                                      ><span class="mord"
                                        ><span class="mord mathnormal" style="margin-right: 0.03588em">y</span
                                        ><span class="mspace" style="margin-right: 0.2778em"></span
                                        ><span class="mrel">←</span
                                        ><span class="mspace" style="margin-right: 0.2778em"></span
                                        ><span class="mord mathnormal" style="margin-right: 0.03588em">y</span
                                        ><span class="mspace" style="margin-right: 0.2222em"></span
                                        ><span class="mbin">+</span
                                        ><span class="mspace" style="margin-right: 0.2222em"></span
                                        ><span class="mord"
                                          ><span class="mord mathnormal" style="margin-right: 0.03588em">v</span
                                          ><span class="msupsub"
                                            ><span class="vlist-t vlist-t2"
                                              ><span class="vlist-r"
                                                ><span class="vlist" style="height: 0.1514em"
                                                  ><span
                                                    style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em"
                                                    ><span class="pstrut" style="height: 2.7em"></span
                                                    ><span class="sizing reset-size6 size3 mtight"
                                                      ><span
                                                        class="mord mathnormal mtight"
                                                        style="margin-right: 0.03588em"
                                                        >y</span
                                                      ></span
                                                    ></span
                                                  ></span
                                                ><span class="vlist-s">​</span></span
                                              ><span class="vlist-r"
                                                ><span class="vlist" style="height: 0.2861em"
                                                  ><span></span></span></span></span></span></span></span></span></span
                                  ><span class="vlist-s">​</span></span
                                ><span class="vlist-r"
                                  ><span class="vlist" style="height: 0.95em"><span></span></span></span></span></span
                            ><span class="arraycolsep" style="width: 0.5em"></span></span></span></span></span></span
                  ><span class="vlist-s">​</span></span
                ><span class="vlist-r"
                  ><span class="vlist" style="height: 0.95em"><span></span></span></span></span></span></span></span
        ><span class="tag"
          ><span class="vlist-t vlist-t2"
            ><span class="vlist-r"
              ><span class="vlist" style="height: 1.45em"
                ><span style="top: -3.45em"
                  ><span class="pstrut" style="height: 3.45em"></span><span class="eqn-num"></span></span></span
              ><span class="vlist-s">​</span></span
            ><span class="vlist-r"
              ><span class="vlist" style="height: 0.95em"><span></span></span></span></span></span></span></span
  ></span>
  (which is the simplest form of motion at a constant velocity). If a bullet goes off-screen or hits a target, it’s
  removed from the game.

  <h4>Collision checks</h4>

  The code for detecting collisions just checks if the two rectangles—one around the bullet, one around the
  target—overlap. If they do, the bullet is marked as hitting the target.
</div>
